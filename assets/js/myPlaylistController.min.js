"use strict";var maxListPlaylist=10;var myPlaylistController=angular.module("myPlaylistController",["ngResource"]);myPlaylistController.controller("myPlaylistController",["$rootScope","$scope","$location","$log","$http","player","aliceBootbox",function(e,t,n,r,i,s,o){e.location="myPlaylist";i.post("/getPlaylist",{}).success(function(e,n,r,o){t.myPlaylists=e;e.forEach(function(e){if(e.isSelected){i.post("/Playlist/getSelectPlaylist",{playlistId:e.id}).success(function(e,n,r,i){t.currentPlaylist=e;s.init(t)})}})});t.addPlaylist=function(){if(t.myPlaylists.length>=maxListPlaylist){o.dialog("Warning, Can not add more than "+maxListPlaylist+" playlists!!","Have too much playlist.");return}bootbox.prompt("Playlist's name : ",function(e){if(e!=null&&e.trim()!=""){i.post("/addPlaylist",{playlistName:e}).success(function(e,n,r,i){t.myPlaylists=e})}})};t.changeSelectPlaylist=function(e){if(e!=t.currentPlaylist.id){i.post("/changeSelectPlaylist",{playlistId:t.currentPlaylist.id,changedPlaylistId:e}).success(function(e,n,r,i){t.currentPlaylist=e;s.updatePlaylist(e)})}};t.updatePlayMethod=function(e){if(e!==t.currentPlaylist.playingMethod){i.post("/updatePlayingMethod",{playingMethod:e,playlistId:t.currentPlaylist.id}).success(function(e,t,n,r){s.updatePlaylist(e)})}};t.selectPlaylist=function(e){t.currentPlayList=e};t.openSearchModal=function(e){t.openWithPlaylistId=e;$("#searchSongModal").modal("show")};t.addSongsToPlaylist=function(e){if(t.currentPlaylist&&t.currentPlaylist.songs.length>=maxListSongs){o.dialog("Warning, Can not add more than "+maxListSongs+" songs!!","Have too much song in this playlist.");return}$("#loading_modal").modal("show");i.post("/addSongsToPlaylist",{songsToPlayList:e,playlistId:t.openWithPlaylistId}).success(function(n,r,o,u){t.currentPlaylist=n;s.init(t);$("#loading_modal").modal("hide");i.post("/songLifeInfo/updateAddCnt",{songId:e.id}).success(function(e,t,n,r){})})};t.searchSong=function(){if(t.searchParam.songName&&t.searchParam.songName.trim()!=""||t.searchParam.albumName&&t.searchParam.albumName.trim()!=""||t.searchParam.artistName&&t.searchParam.artistName.trim()!=""){i.post("/searchSongAdvance",t.searchParam).success(function(e,n,r,i){t.searchedSongs=e})}else{t.searchedSongs=[]}};t.goEditPlaylist=function(e){t.editPlaylist=e;$("#updatePlayListModel").modal("show")};t.updatePlaylist=function(){if(t.editPlaylist&&t.editPlaylist.id){i.post("/updateMyPlaylist",{editedPlaylist:t.editPlaylist}).success(function(e,n,r,i){t.editPlaylist=e;if(n==200){$("#updatePlayListModel").modal("hide")}})}};t.removePlaylist=function(e,n){i.post("/removePlaylist",{removePlaylist:e}).success(function(e,r,i,s){t.myPlaylists.splice(n,1)})};t.removeASongFromPlaylist=function(e,n){$("#loading_modal").modal("show");i.post("/removeASongFromPlaylist",{songId:e,playlistId:t.currentPlaylist.id}).success(function(e,r,i,o){t.currentPlaylist=e;s.currentScope=t;s.playlist=t.currentPlaylist;if(s.currentSongIndex>n&&s.currentSongIndex>0){s.currentSongIndex--;s.currentSong=s.playlist.songs[s.currentSongIndex]}$("#loading_modal").modal("hide")})};t.play=function(){s.play();t.playing=s.playing};t.stop=function(){s.stop();t.playing=s.playing};t.pause=function(){s.pause();t.playing=s.playing};t.playPrev=function(){s.playPrev();t.playing=s.playing};t.playNext=function(){s.playNext();t.playing=s.playing};t.wait=function(e){if(e){$("#loading_modal").modal("show")}else{$("#loading_modal").modal("hide")}};t.error=function(e){o.dialog(e,"Loading error !!")};t.curentPlayingMinutes=function(){if(s.currentScope.progress>0){return t.convertToMinute(parseInt(s.currentScope.progress))}else{return"00:00"}};t.curentDurationMinutes=function(){if(s.currentDuration()>0){return t.convertToMinute(s.currentDuration())}else{return"00:00"}};t.convertToMinute=function(e){if(e&&e>0){var t=Math.floor(e/60);var n=e-t*60;if(t<10){t="0"+t.toString()}if(n<10){n="0"+n.toString()}return t+":"+n}else{return"00:00"}};t.viewSongDetails=function(e){e.showDetails=!e.showDetails;return e.showDetails};t.isActive=function(e){if(s.currentSongIndex==e){return"active"}};t.playThisSong=function(e){if(s.currentSongIndex!=e){s.playAt(e);t.playing=s.playing;t.progress=s.currentTime()}}}])