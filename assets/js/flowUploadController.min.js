"use strict";var maxListSongs=20;var flowUploadPageController=angular.module("flowUploadPageController",["ngResource","angularFileUpload"]);flowUploadPageController.controller("flowUploadController",["$rootScope","$scope","$location","$log","$http","$fileUploader",function(e,t,n,r,i,s){e.location="upload";i.post("/isHasDropboxId",{}).success(function(e,r,i,s){if(!e.isHas){n.path("/home");t.$apply()}});i.post("/getPlaylist",{}).success(function(e,n,r,i){t.playlists=e;e.forEach(function(e){if(e.isSelected){t.playlistId=[e.id]}})});var o=t.uploader=s.create({scope:t,url:"flowUpload",filters:[function(e){console.info("filter1");return true}]});t.countSongs=maxListSongs-t.uploader.queue.length;t.permissions=[{name:"world",value:"World"},{name:"me",value:"Private"}];t.defaultPer=t.permissions[0].name;o.filters.push(function(e){var n=true;t.playlists.forEach(function(e){t.playlistId.forEach(function(r){if(e.id===r&&e.songs.length+t.uploader.queue.length>=maxListSongs){bootbox.dialog({message:"Warning, Can not add more songs into playlist!!",title:"Too much Songs in "+e.name+" .",buttons:{danger:{label:"Close",className:"btn-danger",callback:function(){}}}});n=false}})});var r=o.isHTML5?e.type:"/"+e.value.slice(e.value.lastIndexOf(".")+1);r="|"+r.toLowerCase().slice(r.lastIndexOf("/")+1)+"|";if(n){n="|mp3|x-m4a|m4p|wma|wav|".indexOf(r)!==-1;if(!n){bootbox.dialog({message:"Warning, Can not play this file!!",title:"Not accept file.",buttons:{danger:{label:"Close",className:"btn-danger",callback:function(){}}}})}}return n});o.bind("afteraddingfile",function(e,n){n.formData=[{playlist:t.playlistId,shareTo:t.defaultPer}];console.info("After adding a file",n)});o.bind("afteraddingall",function(e,t){console.info("After adding all files",t)});o.bind("beforeupload",function(e,t){console.info("Before upload",t)});o.bind("progress",function(e,t,n){console.info("Progress: "+n,t)});o.bind("success",function(e,t,n,r){console.info("Success",t,n,r)});o.bind("cancel",function(e,t,n){console.info("Cancel",t,n)});o.bind("error",function(e,t,n,r){console.info("Error",t,n,r)});o.bind("complete",function(e,t,n,r){});o.bind("progressall",function(e,t){console.info("Total progress: "+t)});o.bind("completeall",function(e,r){bootbox.confirm("All songs uploaded, do you want to back to home page?",function(e){if(e){n.path("/home");t.$apply()}});console.info("Complete all",r)})}])