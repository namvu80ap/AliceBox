"use strict";var maxListSongs=20;var maxListPlaylist=10;var mainPageController=angular.module("mainPageController",["uiSlider","ngResource","ui.bootstrap","adaptive.detection","ngTouch"]);mainPageController.controller("mainController",["$rootScope","$scope","$log","$http","player","$detection","aliceBootbox",function(e,t,n,r,i,s,o){e.location="home";t.Search={word:"",permission:"world"};t.newPlaylist={name:""};r.post("/getPlaylist",{}).success(function(e,n,s,o){t.Playlists=e;e.forEach(function(e){if(e.isSelected){r.post("/Playlist/getSelectPlaylist",{playlistId:e.id}).success(function(e,n,r,s){t.currentPlaylist=e;i.init(t)})}})});r.post("/getUserInfo",{}).success(function(e,n,r,i){t.User=e});t.searchSong=function(e){if(t.Search.word.trim()!=""){r.post("/searchSong",{word:t.Search.word,permission:t.Search.permission,songs:e}).success(function(e,n,r,i){t.SearchedSongs=e})}};t.changeSearchPermission=function(e){t.Search.permission=e};t.addPlaylist=function(){if(t.Playlists.length>=maxListPlaylist){o.dialog("Warning, Can not add more than "+maxListPlaylist+" playlists!!","Have too much playlist.");return}bootbox.prompt("Playlist's name : ",function(e){if(e!=null&&e.trim()!=""){r.post("/addPlaylist",{playlistName:e}).success(function(e,n,r,i){t.Playlists=e})}})};t.changeSelectPlaylist=function(e){if(e!=t.currentPlaylist.id){r.post("/changeSelectPlaylist",{playlistId:t.currentPlaylist.id,changedPlaylistId:e}).success(function(e,n,r,s){t.currentPlaylist=e;i.updatePlaylist(e)})}};t.selectPlaylist=function(e){t.currentPlayList=e};t.addSongsToPlaylist=function(e){if(t.currentPlaylist&&t.currentPlaylist.songs.length>=maxListSongs){o.dialog("Warning, Can not add more than "+maxListSongs+" songs!!","Have too much song in this playlist.");return}$("#loading_modal").modal("show");r.post("/addSongsToPlaylist",{songsToPlayList:e,playlistId:t.currentPlaylist.id}).success(function(n,s,o,u){t.currentPlaylist=n;i.init(t);$("#loading_modal").modal("hide");r.post("/songLifeInfo/updateAddCnt",{songId:e.id}).success(function(e,t,n,r){})})};t.removeASongFromPlaylist=function(e,n){$("#loading_modal").modal("show");r.post("/removeASongFromPlaylist",{songId:e,playlistId:t.currentPlaylist.id}).success(function(e,r,s,o){t.currentPlaylist=e;i.currentScope=t;i.playlist=t.currentPlaylist;if(i.currentSongIndex>n&&i.currentSongIndex>0){i.currentSongIndex--;i.currentSong=i.playlist.songs[i.currentSongIndex]}$("#loading_modal").modal("hide")})};t.updatePlayMethod=function(e){if(e!==t.currentPlaylist.playingMethod){r.post("/updatePlayingMethod",{playingMethod:e,playlistId:t.currentPlaylist.id}).success(function(e,t,n,r){i.updatePlaylist(e)})}};t.play=function(){i.play();t.playing=i.playing};t.stop=function(){i.stop();t.playing=i.playing};t.pause=function(){i.pause();t.playing=i.playing};t.playPrev=function(){i.playPrev();t.playing=i.playing};t.playNext=function(){i.playNext();t.playing=i.playing};t.wait=function(e){if(e){$("#loading_modal").modal("show")}else{$("#loading_modal").modal("hide")}};t.error=function(e){o.dialog(e,"Loading error !!")};t.curentPlayingMinutes=function(){if(i.currentScope.progress>0){return t.convertToMinute(parseInt(i.currentScope.progress))}else{return"00:00"}};t.curentDurationMinutes=function(){if(i.currentDuration()>0){return t.convertToMinute(i.currentDuration())}else{return"00:00"}};t.convertToMinute=function(e){if(e&&e>0){var t=Math.floor(e/60);var n=e-t*60;if(t<10){t="0"+t.toString()}if(n<10){n="0"+n.toString()}return t+":"+n}else{return"00:00"}};t.viewSongDetails=function(e){e.showDetails=!e.showDetails;return e.showDetails};t.isActive=function(e){if(i.currentSongIndex==e){return"active"}};t.playThisSong=function(e){if(i.currentSongIndex!=e){i.playAt(e);t.playing=i.playing;t.progress=i.currentTime()}}}])